/*!
 * SMValidator.js 0.9.5
 * Copyright (c) 2016 WLDragon(cwloog@qq.com)
 */!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.SMValidator=r()}(this,function(){"use strict";function e(e){e&&e.required&&(delete e.required,console.warn('"required" customized rule is invalid'))}function r(e){return"string"==typeof e}function s(r,s){var a=this;s||(s={});for(var t=f.length-1;t>=0;t--){var l=f[t];a[l]=s[l]||d[l]}if(a.fields={},a.rules=s.rules||{},r){e(s.rules),a.submit=s.submit;for(var n in s.fields)a.fields[n]=a.parseField(s.fields[n]);a.queryInput(r)}}function a(e,r){if(e)for(var s=e.length-1;s>=0;s--){for(var a=e[s],t=a.target,l=a.className.split(" "),n=t.className.split(" "),i=l.length-1;i>=0;i--){var u=l[i],o=n.indexOf(u);!r&&o>-1?n.splice(o,1):r&&o===-1&&n.push(u)}t.className=n.join(" ")}}function t(e,r,s){if(e)for(var a=e.length-1;a>=0;a--){var t=e[a];t.dom.style.display=r?"":"none",s&&!t.quiet&&(t.dom.innerText=s)}}function l(e,r){if(r)for(var s in r)e.style[s]=r[s]}function n(e,r){var s=e._sm,n=s.rule,i=!0,u=1;if(r&&"number"==typeof r.forceFlag)u=r.forceFlag,n.server&&(s.serverFlag=u,r.serverMessage&&(s.serverMessage=r.serverMessage),2===u&&(s.ruleIndex=-2,i=s.serverMessage||"no reason"));else if(n.server)n.required&&!e.value?(u=2,s.ruleIndex=-1,i=d.requiredMessage):"number"==typeof s.serverFlag?(u=s.serverFlag,2===u&&(s.ruleIndex=-2,i=s.serverMessage||"no reason")):e.value?(u=2,s.ruleIndex=-3,i=d.noServerMessage):u=0;else if(n.required||""!==e.value)for(var o=n.rules.length-1;o>=0;o--){var f=n.rules[o],c=f.rule;if(c instanceof RegExp){if(!c.test(e.value)){i=f.message,s.ruleIndex=o,u=2;break}}else if(i=f.params?c.apply(null,[e.value].concat(f.params)):c.call(null,e.value),i!==!0){s.ruleIndex=o,u=2;break}}else u=0;return u===s.flag&&s.ruleIndex===s.lastRuleIndex||(s.lastRuleIndex=s.ruleIndex,s.flag=u,l(e,s.style),t(s.failHtml,!1),t(s.passHtml,!1),1===u?(a(s.failCss,!1),a(s.passCss,!0),l(e,n.passStyle),t(s.passHtml,!0),n.pass&&n.pass.call(e)):2===u?(a(s.passCss,!1),a(s.failCss,!0),l(e,n.failStyle),t(s.failHtml,!0,i),n.fail&&n.fail.call(e)):(a(s.failCss,!1),a(s.passCss,!1))),2===u&&d._useLocate&&(e.scrollIntoView(),d._useLocate=!1),i}var i=window.document,u=i.addEventListener?i.addEventListener:i.attachEvent,o="oninput"in i?"input":"propertychange";u.call(i,o,function(e){var r=e.target;!r._sm||r._sm.rule.manul||r._sm.rule.blur||n(r)}),u.call(i,"change",function(e){var r=e.target;r._sm&&!r._sm.rule.manul&&n(r)});var f=["server","blur","manul","failHtml","failStyle","failCss","passHtml","passStyle","passCss"],c=s.prototype;c.queryInput=function(e){for(var r=this,a=[],t=i.querySelectorAll(e),l=t.length-1;l>=0;l--){var n=t[l];if("FORM"===n.tagName){n.novalidate="novalidate";for(var o=[],f=n.length-1;f>=0;f--)r.bindInput(n[f])&&o.push(n[f]);a=a.concat(o),r.submit&&o.length&&(n._smInputs=o,u.call(n,"submit",function(e){e.preventDefault();var a=s.validate(e.target._smInputs,{locate:!0});r.submit(a,e.target)}))}else"INPUT"===n.tagName&&r.bindInput(n)&&a.push(n)}return a},c.bindInput=function(e){function s(e,s){if(r(e[s]))try{e[s]=JSON.parse(e[s].replace(/'/g,'"'))}catch(r){console.error("error json format: "+e[s])}}function a(e,r){if(r){e._sm.style||(e._sm.style={});var s=e._sm.style;for(var a in r)s[a]||(s[a]=e.style[a])}}function t(e,s,a){if(a){e._sm[s]=[],r(a)&&(a=[a]);for(var t=0;t<a.length;t++){var l,n=a[t],u={};if(0===n.indexOf("!")&&(n=n.substring(1),u.quiet=!0),0===n.indexOf("<")){var o=i.createElement("div");o.innerHTML=n,l=o.childNodes[0],e.parentNode.insertBefore(l,e.nextElementSibling)}else l=i.querySelector(n);l&&(u.dom=l,l.style.display="none",e._sm[s].push(u))}}}function l(e,s,a){if(a){r(a)&&(a=[a]),e._sm[s]=[];for(var t=a.length-1;t>=0;t--){for(var l=a[t],n=e;0===l.indexOf("+");)l=l.substring(1),n=n.parentNode;e._sm[s].push({target:n,className:l})}}}if(e._sm)return!0;var n=e.getAttribute("name"),u=e.getAttribute("data-rule"),o=u?this.parseString(u):this.fields[n];if(o){if(e._sm={rule:o,flag:0},!o._isInit){o._isInit=!0;for(var c=f.length-1;c>=0;c--){var p=f[c];o[p]||(o[p]=this[p])}o.server&&(o.manul=!0),s(o,"failStyle"),s(o,"passStyle")}return a(e,o.failStyle),a(e,o.passStyle),t(e,"failHtml",o.failHtml),t(e,"passHtml",o.passHtml),l(e,"failCss",o.failCss),l(e,"passCss",o.passCss),!0}return!1},c.parseRule=function(e,r){var s=e.name,a=this.rules[s]||d.rules[s];a&&(a instanceof Array?r.rules.push({rule:a[0],message:a[1]}):r.rules.push({rule:a,params:e.params}),r.required="required"===s)},c.parseStringFunction=function(e){var r={name:e},s=e.indexOf("(");return s>0&&(r.name=e.substring(0,s),r.params=e.substring(s+1,e.length-1).split(",")),r},c.parseString=function(e){for(var r={rules:[]},s=e.split(";"),a=s.length-1;a>=0;a--){var t=s[a];if(t)if(0===t.indexOf("/")){var l=t.substring(1).split("/");2===l.length?r.rules.push({rule:new RegExp(l[0]),message:l[1]}):3===l.length&&r.rules.push({rule:new RegExp(l[0],"i"),message:l[2]})}else{var n=this.parseStringFunction(t);if(f.indexOf(n.name)>-1){var i=n.name;"blur"===i||"manul"===i||"server"===i?r[i]=!0:"failStyle"===i||"passStyle"===i?r[i]=n.params[0]:r[i]=n.params}else this.parseRule(n,r)}}return r},c.parseField=function(e){if(e instanceof Array)return{rules:[{rule:e[0],message:e[1]}]};if(e instanceof Function)return{rules:[{rule:e}]};if(r(e))return this.parseString(e);if("object"==typeof e){if(e.rule instanceof Array)e.rules=[{rule:e.rule[0],message:e.rule[1]}];else if(e.rule instanceof Function)e.rules=[{rule:e.rule}];else if(r(e.rule)){var s=e.rule.split(";");e.rules=[];for(var a=s.length-1;a>=0;a--)""!==s[a]&&this.parseRule(this.parseStringFunction(s[a]),e);delete e.rule}return e}};var p,d={noServerMessage:"not been validated by server",requiredMessage:"this is required",rules:{required:function(e){return!!e||d.requiredMessage}}};s.config=function(r){for(var a=f.concat(["noServerMessage","requiredMessage"]),t=a.length-1;t>=0;t--){var l=a[t];r[l]&&(d[l]=r[l])}if(r.rules){e(r.rules);for(var n in r.rules)d.rules[n]=r.rules[n]}p=new s},s.validate=function(e,s){var a=r(e)?p.queryInput(e):e,t=0,l=0;s&&s.locate&&(d._useLocate=!0);for(var i=a.length-1;i>=0;i--){var u=a[i];u._sm&&(l++,n(u,s)===!0&&t++)}return l===t},s.reset=function(e){s.validate(e,{forceFlag:0})},s.config({requiredMessage:"这是必填字段",noServerMessage:"还没经过服务器验证",rules:{number:[/^-?\d+$/,"只能输入数字"],email:[/^[\w\+\-]+(\.[\w\+\-]+)*@[a-z\d\-]+(\.[a-z\d\-]+)*\.([a-z]{2,4})$/i,"邮箱格式不正确"],range:function(e,r,s){e=1*e;var a=/^-?\d+$/;return a.test(e)?r&&!a.test(r)&&s&&!a.test(s)?"无效参数":2===arguments.length?e==r||"值必须等于"+r:3===arguments.length?r&&s?e>r&&e<s||"值必须大于 "+r+" 且小于 "+s:r?e>r||"值必须大于 "+r:s?e<s||"值必须小于 "+s:"无效参数":void 0:"不是数字"},length:function(e,r,s){var a=e.length;return 2===arguments.length?a==r||"长度必须等于"+r:3===arguments.length?r&&s?a>r&&a<s||"长度必须大于 "+r+" 且小于 "+s:r?a>r||"长度必须大于 "+r:s?a<s||"长度必须小于 "+s:"无效参数":void 0},equal:function(e,r){var s=i.querySelector(r);return e===s.value||"您输入的密码不一致"}}});var v={default:{failHtml:'<span style="color:#c00;"></span>',failStyle:{color:"#c00",border:"1px solid #c00"}},bootstrap:{failStyle:{},failHtml:['!<span class="glyphicon glyphicon-remove form-control-feedback"></span>','<small class="help-block"></small>'],failCss:"++has-error has-feedback",passHtml:'<span class="glyphicon glyphicon-ok form-control-feedback"></span>',passCss:"++has-success has-feedback"}};return s.setSkin=function(e){s.config(v[e])},s.setSkin("default"),s});