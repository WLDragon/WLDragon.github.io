/*!
 * sm-validator 0.10.1
 * Copyright (c) 2016 WLDragon(cwloog@qq.com)
 */!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.SMValidator=r()}(this,function(){"use strict";function e(e){e&&e.required&&(delete e.required,console.warn('"required" customized rule is invalid'))}function r(e){return"string"==typeof e}function s(r,s){var a=this;s||(s={});for(var t=f.length-1;t>=0;t--){var l=f[t];a[l]=s[l]||m[l]}if(a.fields={},a.rules=s.rules||{},r){e(s.rules),a.submit=s.submit;for(var n in s.fields)a.fields[n]=a.parseField(s.fields[n]);a.queryInput(r)}}function a(e,r){if(e)for(var s=e.length-1;s>=0;s--){for(var a=e[s],t=a.target,l=a.className.split(" "),n=t.className.split(" "),i=l.length-1;i>=0;i--){var u=l[i],o=n.indexOf(u);!r&&o>-1?n.splice(o,1):r&&o===-1&&n.push(u)}t.className=n.join(" ")}}function t(e,r,s){if(e)for(var a=e.length-1;a>=0;a--){var t=e[a];t.dom.style.display=r?"":"none",s&&!t.quiet&&(t.dom.innerText=s)}}function l(e,r){if(r)for(var s in r)e.style[s]=r[s]}function n(e,r){var s=e.type,n=e.name,i=e._sm,u=i.rule,o=!0,f=1,c="";if("checkbox"!==s&&"radio"!==s||!e.form)if("select-multiple"===s)for(var p=e.children,g=p.length-1;g>=0;g--)p[g].selected&&p[g].value&&(c+=" ");else c=e.value;else for(var p=e.form.elements[n],g=p.length-1;g>=0;g--)p[g].checked&&(c+=" ");if(r&&"number"==typeof r.forceFlag)f=r.forceFlag,u.server&&(i.serverFlag=f,r.serverMessage&&(i.serverMessage=r.serverMessage),2===f&&(o=i.serverMessage||"no reason"));else if(u.server)u.required&&!c?(f=2,o=m.requiredMessage):"number"==typeof i.serverFlag?(f=i.serverFlag,2===f&&(o=i.serverMessage||"no reason")):c?(f=2,o=m.noServerMessage):f=0;else if(u.required||""!==c)for(var g=u.rules.length-1;g>=0;g--){var v=u.rules[g],d=v.rule;if(d instanceof RegExp){if(!d.test(c)){o=v.message,f=2;break}}else if(o=v.params?d.apply(null,[c].concat(v.params)):d.call(null,c),o!==!0){f=2;break}}else f=0;return f===i.flag&&i.lastResult===o||(i.lastResult=o,i.flag=f,l(e,i.style),t(i.failHtml,!1),t(i.passHtml,!1),1===f?(a(i.failCss,!1),a(i.passCss,!0),l(e,u.passStyle),t(i.passHtml,!0),u.pass&&u.pass.call(e)):2===f?(a(i.passCss,!1),a(i.failCss,!0),l(e,u.failStyle),t(i.failHtml,!0,o),u.fail&&u.fail.call(e)):(a(i.failCss,!1),a(i.passCss,!1))),2===f&&m._useLocate&&(e.scrollIntoView(),m._useLocate=!1),o}var i=window.document,u=i.addEventListener?i.addEventListener:i.attachEvent,o="oninput"in i?"input":"propertychange";u.call(i,o,function(e){var r=e.target;!r._sm||r._sm.rule.manul||r._sm.rule.blur||n(r)}),u.call(i,"change",function(e){var r=e.target;r._sm&&!r._sm.rule.manul&&r._sm.rule.blur&&n(r)});var f=["server","blur","manul","failHtml","failStyle","failCss","passHtml","passStyle","passCss"],c=s.prototype;c.queryInput=function(e){for(var r=this,a=[],t=i.querySelectorAll(e),l=t.length-1;l>=0;l--){var n=t[l],o=n.tagName;if("FORM"===o){n.novalidate="novalidate";for(var f=[],c=n.length-1;c>=0;c--)r.bindInput(n[c])&&f.push(n[c]);a=a.concat(f),r.submit&&f.length&&(n._smInputs=f,u.call(n,"submit",function(e){e.preventDefault();var a=s.validate(e.target._smInputs,{locate:!0});r.submit(a,e.target)}))}else"INPUT"!==o&&"SELECT"!==o&&"TEXTAREA"!==o||r.bindInput(n)&&a.push(n)}return a},c.bindInput=function(e){function s(e,s){if(r(e[s]))try{e[s]=JSON.parse(e[s].replace(/'/g,'"'))}catch(a){console.error("error json format: "+e[s])}}function a(e,r){if(r){e._sm.style||(e._sm.style={});var s=e._sm.style;for(var a in r)s[a]||(s[a]=e.style[a])}}function t(e,s,a){if(a){e._sm[s]=[],r(a)&&(a=[a]);for(var t=0;t<a.length;t++){var l,n=a[t],u={};if(0===n.indexOf("!")&&(n=n.substring(1),u.quiet=!0),n.indexOf("<")>-1){for(var o=e;0===n.indexOf("+");)n=n.substring(1),o=o.parentNode;var f=i.createElement("div");f.innerHTML=n,l=f.childNodes[0],o.parentNode.insertBefore(l,o.nextElementSibling)}else l=i.querySelector(n);l&&(u.dom=l,l.style.display="none",e._sm[s].push(u))}}}function l(e,s,a){if(a){r(a)&&(a=[a]),e._sm[s]=[];for(var t=a.length-1;t>=0;t--){for(var l=a[t],n=e;0===l.indexOf("+");)l=l.substring(1),n=n.parentNode;e._sm[s].push({target:n,className:l})}}}if(e._sm)return!0;var n=e.getAttribute("name"),u=e.getAttribute("data-rule"),o=u?this.parseString(u):this.fields[n];if(o){if(e._sm={rule:o,flag:0},"checkbox"===e.type||"radio"===e.type){for(var c=i.querySelectorAll('input[name="'+n+'"]'),p=c.length-1;p>=0;p--)c[p]!==e&&(c[p]._sm=e._sm);o.blur=!0}if(!o._isInit){o._isInit=!0;for(var p=f.length-1;p>=0;p--){var m=f[p];o[m]||(o[m]=this[m])}o.server&&(o.manul=!0),s(o,"failStyle"),s(o,"passStyle")}return a(e,o.failStyle),a(e,o.passStyle),t(e,"failHtml",o.failHtml),t(e,"passHtml",o.passHtml),l(e,"failCss",o.failCss),l(e,"passCss",o.passCss),!0}return!1},c.parseRule=function(e,r){var s=e.name,a=this.rules[s]||m.rules[s];a&&(a instanceof Array?r.rules.push({rule:a[0],message:a[1]}):r.rules.push({rule:a,params:e.params}),r.required="required"===s)},c.parseStringFunction=function(e){var r={name:e},s=e.indexOf("(");return s>0&&(r.name=e.substring(0,s),r.params=e.substring(s+1,e.length-1).split(",")),r},c.parseString=function(e){for(var r={rules:[]},s=e.split(";"),a=s.length-1;a>=0;a--){var t=s[a];if(t)if(0===t.indexOf("/")){var l=t.substring(1).split("/");2===l.length?r.rules.push({rule:new RegExp(l[0]),message:l[1]}):3===l.length&&r.rules.push({rule:new RegExp(l[0],"i"),message:l[2]})}else{var n=this.parseStringFunction(t);if(f.indexOf(n.name)>-1){var i=n.name;"blur"===i||"manul"===i||"server"===i?r[i]=!0:"failStyle"===i||"passStyle"===i?r[i]=n.params[0]:r[i]=n.params}else this.parseRule(n,r)}}return r},c.parseField=function(e){if(e instanceof Array)return{rules:[{rule:e[0],message:e[1]}]};if(e instanceof Function)return{rules:[{rule:e}]};if(r(e))return this.parseString(e);if("object"==typeof e){if(e.rule instanceof Array)e.rules=[{rule:e.rule[0],message:e.rule[1]}];else if(e.rule instanceof Function)e.rules=[{rule:e.rule}];else if(r(e.rule)){var s=e.rule.split(";");e.rules=[];for(var a=s.length-1;a>=0;a--)""!==s[a]&&this.parseRule(this.parseStringFunction(s[a]),e);delete e.rule}return e}};var p,m={noServerMessage:"not been validated by server",requiredMessage:"this is required",rules:{required:function(e){return!!e||m.requiredMessage}}};s.config=function(r){for(var a=f.concat(["noServerMessage","requiredMessage"]),t=a.length-1;t>=0;t--){var l=a[t];r[l]&&(m[l]=r[l])}if(r.rules){e(r.rules);for(var n in r.rules)m.rules[n]=r.rules[n]}p=new s},s.validate=function(e,s){var a=r(e)?p.queryInput(e):e,t=0,l=0;s&&s.locate&&(m._useLocate=!0);for(var i=a.length-1;i>=0;i--){var u=a[i];u._sm&&(l++,n(u,s)===!0&&t++)}return l===t},s.reset=function(e){s.validate(e,{forceFlag:0})},s.config({requiredMessage:"这是必填字段",noServerMessage:"还没经过服务器验证",failHtml:'<span style="color:#c00;"></span>',failStyle:{color:"#c00",border:"1px solid #c00"},rules:{number:[/^-?\d+$/,"只能输入数字"],email:[/^[\w\+\-]+(\.[\w\+\-]+)*@[a-z\d\-]+(\.[a-z\d\-]+)*\.([a-z]{2,4})$/i,"邮箱格式不正确"],range:function(e,r,s){e=1*e;var a=/^-?\d+$/;return a.test(e)?r&&!a.test(r)&&s&&!a.test(s)?"无效参数":2===arguments.length?e==r||"值必须等于"+r:3===arguments.length?r&&s?e>r&&e<s||"值必须大于 "+r+" 且小于 "+s:r?e>r||"值必须大于 "+r:s?e<s||"值必须小于 "+s:"无效参数":void 0:"不是数字"},length:function(e,r,s){var a=e.length;return 2===arguments.length?a==r||"长度必须等于"+r:3===arguments.length?r&&s?a>r&&a<s||"长度必须大于 "+r+" 且小于 "+s:r?a>r||"长度必须大于 "+r:s?a<s||"长度必须小于 "+s:"无效参数":void 0},equal:function(e,r){var s=i.querySelector(r);return e===s.value||"您输入的密码不一致"}}});var g={bootstrap:{failStyle:{},failHtml:['!<span class="glyphicon glyphicon-remove form-control-feedback"></span>','<small class="help-block"></small>'],failCss:"++has-error has-feedback",passHtml:'<span class="glyphicon glyphicon-ok form-control-feedback"></span>',passCss:"++has-success has-feedback"},semantic:{failStyle:{},failHtml:['!<i class="remove icon"></i>','+<small class="ui red pointing label"></small>'],failCss:"++error",passHtml:'<i class="checkmark icon"></i>'}};return s.setSkin=function(e){s.config(g[e])},s});