/*!
 * SMValidator.js 0.9.2
 * Copyright (c) 2016 WLDragon(cwloog@qq.com)
 */!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.SMValidator=r()}(this,function(){"use strict";function e(e){if(e&&e.required)throw new Error('can\'t cover the rule "required"')}function r(r,t){if(r){var s=this;t||(t={});for(var l=f.length-1;l>=0;l--){var n=f[l];s[n]=t[n]||p[n]}e(t.rules),s.rules=t.rules||{},s.submit=t.submit,s.fields={};for(var i in t.fields)s.fields[i]=s.parseField(t.fields[i]);s.queryInput(r)}}function t(e,r,t){if(r){var s=e.className.split(" "),l=s.indexOf(r);!t&&l>-1?(s.splice(l,1),e.className=s.join(" ")):t&&l===-1&&(e.className+=e.className?" "+r:r)}}function s(e,r){e&&(e.style.display=r?"":"none")}function l(e,r){if(r)for(var t in r)e.style[t]=r[t]}function n(e,r){var n=e._sm,i=n.rule,a=!0,u=1;if(r&&"number"==typeof r.forceFlag)u=r.forceFlag,i.server&&(n.serverFlag=u);else if(i.server)i.required&&""===e.value?(u=2,a=p.requiredTips):(u=n.serverFlag||0,2===u&&(a=!1));else if(i.required||""!==e.value)for(var f=i.rules.length-1;f>=0;f--){var o=i.rules[f],c=o.rule;if(c instanceof RegExp){if(!c.test(e.value)){a=o.message,n.ruleIndex=f,u=2;break}}else if(a=o.params?c.apply(null,[e.value].concat(o.params)):c.call(null,e.value),a!==!0){n.ruleIndex=f,u=2;break}}else u=0;return u===n.flag&&n.ruleIndex===n.lastRuleIndex||(n.lastRuleIndex=n.ruleIndex,n.flag=u,l(e,n.style),s(n.failHtml,!1),s(n.passHtml,!1),1===u?(t(e,i.failCss,!1),t(e,i.passCss,!0),l(e,i.passStyle),s(n.passHtml,!0),i.pass&&i.pass.call(e)):2===u?(t(e,i.passCss,!1),t(e,i.failCss,!0),l(e,i.failStyle),s(n.failHtml,!0),n.failHtml&&!n._quiet&&(n.failHtml.innerText=a),i.fail&&i.fail.call(e)):(t(e,i.failCss,!1),t(e,i.passCss,!1))),2===u&&p._useLocate&&(e.scrollIntoView(),p._useLocate=!1),a}var i=window.document,a=i.addEventListener?i.addEventListener:i.attachEvent,u="oninput"in i?"input":"propertychange";a.call(i,u,function(e){var r=e.target;!r._sm||r._sm.rule.manul||r._sm.rule.blur||n(r)}),a.call(i,"change",function(e){var r=e.target;r._sm&&!r._sm.rule.manul&&n(r)});var f=["server","blur","manul","failHtml","failStyle","failCss","passHtml","passStyle","passCss"],o=r.prototype;o.queryInput=function(e){for(var t=this,s=[],l=i.querySelectorAll(e),n=l.length-1;n>=0;n--){var u=l[n];if("FORM"===u.tagName){u.novalidate="novalidate";for(var f=[],o=u.length-1;o>=0;o--)t.bindInput(u[o])&&f.push(u[o]);s=s.concat(f),t.submit&&f.length&&(u._smInputs=f,a.call(u,"submit",function(e){e.preventDefault();var s=r.validate(e.target._smInputs,{locate:!0});t.submit(s,e.target)}))}else"INPUT"===u.tagName&&t.bindInput(u)&&s.push(u)}return s},o.bindInput=function(e){function r(e,r){if("string"==typeof e[r])try{e[r]=JSON.parse(e[r].replace(/'/g,'"'))}catch(t){console.error("error json format: "+e[r])}}function t(e,r){if(r){e._sm.style||(e._sm.style={});var t=e._sm.style;for(var s in r)t[s]||(t[s]=e.style[s])}}function s(e,r,t){if(t){var s;if(0===t.indexOf("!")&&(t=t.substring(1),e._sm._quiet=!0),0===t.indexOf("<")){var l=i.createElement("div");l.innerHTML=t,s=l.childNodes[0],e.parentNode.insertBefore(s,e.nextElementSibling)}else s=i.querySelector(t);s&&(s.style.display="none",e._sm[r]=s)}}if(e._sm)return!0;var l=e.getAttribute("name"),n=e.getAttribute("data-rule"),a=n?this.parseString(n):this.fields[l];if(a){if(e._sm={rule:a,flag:0},!a._isInit){a._isInit=!0;for(var u=f.length-1;u>=0;u--){var o=f[u];a[o]||(a[o]=this[o])}r(a,"failStyle"),r(a,"passStyle")}return a.server&&(e._sm._quiet=!0),t(e,a.failStyle),t(e,a.passStyle),s(e,"failHtml",a.failHtml),s(e,"passHtml",a.passHtml),!0}return!1},o.parseRule=function(e,r){var t=e.name,s=this.rules[t]||p.rules[t];s&&(s instanceof Array?r.rules.push({rule:s[0],message:s[1]}):r.rules.push({rule:s,params:e.params}),r.required="required"===t)},o.parseStringFunction=function(e){var r={name:e},t=e.indexOf("(");return t>0&&(r.name=e.substring(0,t),r.params=e.substring(t+1,e.length-1).split(",")),r},o.parseString=function(e){for(var r={rules:[]},t=e.split(";"),s=t.length-1;s>=0;s--){var l=t[s];if(""!==l)if(0===l.indexOf("/")){var n=l.substring(1).split("/");2===n.length?r.rules.push({rule:new RegExp(n[0]),message:n[1]}):3===n.length&&r.rules.push({rule:new RegExp(n[0],"i"),message:n[2]})}else{var i=this.parseStringFunction(l);if(f.indexOf(i.name)>-1){var a=i.name;"blur"===a||"manul"===a||"server"===a?r[a]=!0:r[a]=i.params[0]}else this.parseRule(i,r)}}return r},o.parseField=function(e){if(e instanceof Array)return{rules:[{rule:e[0],message:e[1]}]};if(e instanceof Function)return{rules:[{rule:e}]};if("string"==typeof e)return this.parseString(e);if("object"==typeof e){if(e.rule instanceof Array)e.rules=[{rule:e.rule[0],message:e.rule[1]}];else if(e.rule instanceof Function)e.rules=[{rule:e.rule}];else if("string"==typeof e.rule){var r=e.rule.split(";");e.rules=[];for(var t=r.length-1;t>=0;t--)""!==r[t]&&this.parseRule(this.parseStringFunction(r[t]),e);delete e.rule}return e}};var p={requiredTips:"this is required",rules:{required:function(e){return""!==e||p.requiredTips}}};r.config=function(r){r.requiredTips&&(p.requiredTips=r.requiredTips);for(var t=f.length-1;t>=0;t--){var s=f[t];r[s]&&(p[s]=r[s])}if(r.rules){e(r.rules);for(var l in r.rules)p.rules[l]=r.rules[l]}};var c=new r;return c.rules=c.fields={},r.validate=function(e,r){var t="string"==typeof e?c.queryInput(e):e,s=0,l=0;r&&r.locate&&(p._useLocate=!0);for(var i=t.length-1;i>=0;i--){var a=t[i];a._sm&&(l++,n(a,r)===!0&&s++)}return l===s},r.reset=function(e){r.validate(e,{forceFlag:0})},r.config({requiredTips:"这是必填字段",failHtml:'<span style="color:#c00;"></span>',failStyle:{color:"#c00",border:"1px solid #c00"},rules:{number:[/^-?\d+$/,"只能输入数字"],email:[/^[\w\+\-]+(\.[\w\+\-]+)*@[a-z\d\-]+(\.[a-z\d\-]+)*\.([a-z]{2,4})$/i,"邮箱格式不正确"],range:function(e,r,t){e=1*e;var s=/^-?\d+$/;return s.test(e)?""===r||s.test(r)||""===t||s.test(t)?2===arguments.length?e==r||"值必须等于"+r:3===arguments.length?r&&t?e>r&&e<t||"值必须大于 "+r+" 且小于 "+t:r?e>r||"值必须大于 "+r:t?e<t||"值必须小于 "+t:"无效参数":void 0:"无效参数":"不是数字"},length:function(e,r,t){var s=e.length;return 2===arguments.length?s==r||"长度必须等于"+r:3===arguments.length?r&&t?s>r&&s<t||"长度必须大于 "+r+" 且小于 "+t:r?s>r||"长度必须大于 "+r:t?s<t||"长度必须小于 "+t:"无效参数":void 0},equal:function(e,r){var t=i.querySelector(r);return e===t.value||"您输入的密码不一致"}}}),r});