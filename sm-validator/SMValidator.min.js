/*!
 * Copyright (c) 2016 WLDragon(cwloog@qq.com)
 */
!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.SMValidator=b()}(this,function(){"use strict";function d(a,b){if(a){b||(b={}),this.blur=b.blur,this.manul=b.manul,this.submit=b.submit,this.rules=b.rules||{},this.failHtml=b.failHtml||j.failHtml,this.failStyle=b.failStyle||j.failStyle,this.failClass=b.failClass||j.failClass,this.fields={};for(var c in b.fields)this.fields[c]=this.parseRule(b.fields[c]);this.inputs=this.queryInput(a)}}function f(a,b,c){var d=a.className.split(" "),e=d.indexOf(b);c&&e>-1?(d.splice(e,1),a.className=d.join(" ")):c||-1!==e||(a.className+=a.className?" "+b:b)}function g(a,b,c){for(var d=b.length-1;d>=0;d--)b[d].style.display=c?"none":""}function h(a,b){for(var c in b)a.style[c]=b[c]}function i(a){var b,c,d,e,i;if("text"===a.type){if(b=a._SMRule_,c=!0,b.required||""!==a.value)for(d=b.rules.length-1;d>=0;d--)if(e=b.rules[d],e.rule instanceof RegExp){if(!e.rule.test(a.value)){c=e.message;break}}else if(e.params?(i=[a.value].concat(e.params),c=e.rule.apply(null,i)):c=e.rule.call(null,a.value),c!==!0)break;return c===!0?(b.failClass&&f(a,b.failClass,!0),b.failStyle&&h(a,a._SMStyle_),b.failSelector?g(a,b.failSelector,!0):a._failHtml_.style.display="none"):(b.failClass&&f(a,b.failClass,!1),b.failStyle&&h(a,b.failStyle),b.failSelector?g(a,b.failSelector,!1):(a._failHtml_.innerText=c,a._failHtml_.style.display="")),c}}var e,j,k,a=window.document,b=a.addEventListener?a.addEventListener:a.attachEvent,c="oninput"in a?"input":"propertychange";return b.call(a,c,function(a){var b=a.target;!b._SMRule_||b._SMRule_.manul||b._SMRule_.blur||i(b)}),b.call(a,"change",function(a){var b=a.target;b._SMRule_&&!b._SMRule_.manul&&b._SMRule_.blur&&i(b)}),e=d.prototype,e.queryInput=function(c,e){var i,j,k,l,f=this,g=[],h=a.querySelectorAll(c);for(i=h.length-1;i>=0;i--)if(j=h[i],"FORM"===j.tagName){for(j.novalidate="novalidate",k=[],l=j.length-1;l>=0;l--)f.bindInput(j[l],e)&&k.push(j[l]);g=g.concat(k),f.submit&&k.length&&(j._SMInputs_=k,b.call(j,"submit",function(a){a.preventDefault();var b=d.validate(a.target._SMInputs_,!0);f.submit(b,a.target)}))}else"INPUT"===j.tagName&&f.bindInput(j,e)&&g.push(j);return g},e.bindInput=function(b,c){var d,e,f,g,h,i,k;if(b._SMRule_&&!c)return!0;if(d=b.getAttribute("name"),e=b.getAttribute("data-rule"),f=e?this.parseString(e):this.fields[d]){if(b._SMRule_=f,f.failStyle!==!0){f.failStyle||f._isInit||(f.failStyle=this.failStyle||j.failStyle),b._SMStyle_={};for(g in f.failStyle)b._SMStyle_[g]=b.style[g]}if(!f._isInit){if(f._isInit=!0,f.blur||(f.blur=this.blur),f.manul||(f.manul=this.manul),f.failSelector){if(h=a.querySelectorAll(f.failSelector),h.length){for(f.failSelector=h,i=h.length-1;i>=0;i--)h[i].style.display="none";return!0}f.failSelector=null}f._useFailHtml=!0,f.failHtml||(f.failHtml=this.failHtml||j.failHtml)}return f._useFailHtml&&(k=a.createElement("div"),k.innerHTML=f.failHtml,b._failHtml_=k.childNodes[0],b.parentNode.insertBefore(b._failHtml_,b.nextElementSibling)),!0}return!1},e.parseFunctionOrArray=function(a){var d,e,b={},c=a.indexOf("(");return c>0&&(d=a.indexOf(")"),b.params=a.substring(c+1,d).split(","),a=a.substring(0,c)),e=this.rules[a]||j.rules[a],e instanceof Array?(b.rule=e[0],b.message=e[1]):b.rule=e,b},e.parseString=function(a){var d,e,f,g,h,b={rules:[]},c=a.split(";");for(d=c.length-1;d>=0;d--)e=c[d],""!==e&&(f=e.charAt(0),g=e.substring(1),"/"===f?(h=g.split("/"),2===h.length?b.rules.push({rule:new RegExp(h[0]),message:h[1]}):3===h.length&&b.rules.push({rule:new RegExp(h[0],"i"),message:h[2]})):"#"===f?b.failSelector=g:"!"===f?b.failClass=g:"@"===f?b[g]=!0:(b.rules.push(this.parseFunctionOrArray(e)),b.required="required"===e));return b},e.parseRule=function(a){var b,c;if(a instanceof Array)return{rules:[{rule:a[0],message:a[1]}]};if(a instanceof Function)return{rules:[{rule:a}]};if("string"==typeof a)return this.parseString(a);if("object"==typeof a){if(a.rule instanceof Array)a.rules=[{rule:a.rule[0],message:a.rule[1]}];else if(a.rule instanceof Function)a.rules=[{rule:a.rule}];else if("string"==typeof a.rule)for(b=a.rule.split(";"),a.rules=[],c=b.length-1;c>=0;c--)a.rules.push(this.parseFunctionOrArray(b[c]));return delete a.rule,a}},e.validate=function(a,b){return d.validate(this.inputs,a,b)},j={failHtml:'<span style="color:#c00;"></span>',failStyle:{color:"#c00",border:"1px solid #c00"},rules:{required:function(a){return""!==a||"这是必填项"},range:function(a,b,c){var d=a.length;return 2===arguments.length?b>=0?d>b||"长度必须大于"+b:-b>d||"长度必须小于"+-b:3===arguments.length?d>b&&c>d||"长度必须大于 "+b+" 且小于 "+c:void 0}}},d.config=function(a){if(a.failStyle&&(j.failStyle=a.failStyle),a.failHtml&&(j.failHtml=a.failHtml),a.rules)for(var b in a.rules)j.rules[b]=parseRule(a.rules[b])},k=new d,k.rules=k.fields={},d.validate=function(a,b,c){var g,h,d="string"==typeof a?k.queryInput(a,c):a,e=d.length,f=0;for(g=0;e>g;g++)h=d[g],(h._SMRule_.manul||b)&&i(h)===!0&&f++;return f===e},d});