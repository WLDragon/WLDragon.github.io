/*!
 * SMValidator 1.0.0
 * Copyright (c) 2016 WLDragon(cwloog@qq.com)
 * Released under the MIT License.
 */!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.SMValidator=r()}(this,function(){"use strict";function e(e){return"string"==typeof e}function r(e,r){return p.call(e,r)}function s(e,s){var t=this;s||(s={});for(var a=m.length-1;a>=0;a--){var n=m[a];t[n]=r(s,n)?s[n]:y[n]}if(t.fields={},t.rules=s.rules||{},e){t.submit=s.submit;for(var l in s.fields)t.fields[l]=t.parseField(s.fields[l]);t.queryInput(e)}}function t(e,r){if(e)for(var s=e.length-1;s>=0;s--){for(var t=e[s],a=t.target,n=t.className.split(" "),l=a.className.split(" "),i=n.length-1;i>=0;i--){var u=n[i],o=l.indexOf(u);!r&&o>-1?l.splice(o,1):r&&o===-1&&l.push(u)}a.className=l.join(" ")}}function a(e,r,s){if(e)for(var t=e.length-1;t>=0;t--){var a=e[t];a.dom.style.display=r?"":"none",s&&!a.quiet&&(a.dom.innerHTML=s)}}function n(e,r){if(r)for(var s in r)e.style[s]=r[s]}function l(e){var r=e._sm;n(e,r.style),a(r.failHtml,!1),a(r.passHtml,!1),t(r.failCss,!1),t(r.passCss,!1)}function i(e,r){var s=e.type,i=e.name,u=e._sm,o=u.rule,f=!0,c=[],p=1,m="",g="|"===o.token;if("checkbox"!==s&&"radio"!==s||!e.form)if("select-multiple"===s)for(var h=e.children,d=h.length-1;d>=0;d--)h[d].selected&&h[d].value&&(m+=" ");else m=e.value;else for(var h=e.form.elements[i],d=h.length-1;d>=0;d--)h[d].checked&&(m+=" ");if(r&&"number"==typeof r.forceFlag)p=r.forceFlag,o.server&&(u.serverFlag=p,r.serverMessage&&(u.serverMessage=r.serverMessage),2===p&&(f=u.serverMessage||"no serverMessage!"));else if(o.server)o.required&&!m?(p=2,f=o.required):"number"==typeof u.serverFlag?(p=u.serverFlag,2===p&&(f=u.serverMessage||"no serverMessage!")):m?(p=2,f=o.server):p=0;else if(m)for(var d=o.rules.length-1;d>=0;d--){var y=o.rules[d],b=y.rule;if(b instanceof RegExp){if(!b.test(m)){if(f=y.message,p=2,g)break;c.push(f)}}else if(f=y.params?b.apply(null,[m].concat(y.params)):b.call(null,m),f!==!0){if(p=2,g)break;c.push(f)}}else o.required?(p=2,f=o.required,g||c.push(f)):p=0;return g||(p=c.length?2:1),l(e),1===p?(t(u.failCss,!1),t(u.passCss,!0),n(e,o.passStyle),a(u.passHtml,!0),o.pass&&o.pass.call(e)):2===p&&(t(u.passCss,!1),t(u.failCss,!0),n(e,o.failStyle),a(u.failHtml,!0,g?f:c.join("<br/>")),o.fail&&o.fail.call(e,g?f:c)),2===p&&v&&(e.scrollIntoView(),v=!1),f}function u(e,r){for(var s=0;s<r.length;s++)e=e.replace("{"+s+"}",r[s]);return e}var o=window.document,f=o.addEventListener?o.addEventListener:o.attachEvent,c="oninput"in o?"input":"propertychange";f.call(o,c,function(e){var r=e.target;!r._sm||r._sm.rule.disinput||r._sm.rule.manul||i(r)}),f.call(o,"change",function(e){var r=e.target;"checkbox"!==r.type&&"radio"!==r.type||r._sm&&!r._sm.rule.manul&&i(r)});var p=Object.prototype.hasOwnProperty,m=["required","server","short","disinput","disblur","focus","manul","failHtml","failStyle","failCss","passHtml","passStyle","passCss"],g=m.slice(3),h=s.prototype;h.queryInput=function(e){for(var r=this,t=[],a=o.querySelectorAll(e),n=a.length-1;n>=0;n--){var l=a[n],i=l.tagName;if("FORM"===i){l.novalidate="novalidate";for(var u=[],c=l.length-1;c>=0;c--)r.bindInput(l[c])&&u.push(l[c]);t=t.concat(u),r.submit&&u.length&&(l._smInputs=u,f.call(l,"submit",function(e){e.preventDefault();var t=s.validate(e.target._smInputs,{locate:!0,short:r.short});r.submit(t,e.target)}))}else"INPUT"!==i&&"SELECT"!==i&&"TEXTAREA"!==i||r.bindInput(l)&&t.push(l)}return t},h.bindInput=function(e){if(e._sm)return!0;var s=this,t=e.getAttribute("name"),a=e.getAttribute("data-rule"),n=a?this.parseString(a):this.fields[t];if(n){if(e._sm={rule:n,flag:0},!n._isInit){n._isInit=!0,s.handleProperty(n,"required"),s.handleProperty(n,"server"),n.server&&(n.manul=!0);for(var u=g.length-1;u>=0;u--){var c=g[u];r(n,c)||(n[c]=this[c])}s.handleStyle(n,"failStyle"),s.handleStyle(n,"passStyle")}if("checkbox"===e.type||"radio"===e.type){for(var p=o.querySelectorAll('input[name="'+t+'"]'),u=p.length-1;u>=0;u--)p[u]!==e&&(p[u]._sm=e._sm);n.disblur=n.disinput=!0,n.focus=!1}return s.recordStyle(e,n.failStyle),s.recordStyle(e,n.passStyle),s.handleHtml(e,"failHtml",n.failHtml),s.handleHtml(e,"passHtml",n.passHtml),s.handleCss(e,"failCss",n.failCss),s.handleCss(e,"passCss",n.passCss),n.focus&&f.call(e,"focus",function(e){l(e.target)}),n.disblur||f.call(e,"blur",function(e){i(e.target)}),!0}return!1},h.handleProperty=function(e,s){r(e,s)?e[s]===!0&&(e[s]=this[s]):e[s]=!1},h.handleStyle=function(r,s){if(e(r[s]))try{r[s]=JSON.parse(r[s].replace(/'/g,'"'))}catch(e){console.error("error json format: "+r[s])}},h.recordStyle=function(e,r){if(r){e._sm.style||(e._sm.style={});var s=e._sm.style;for(var t in r)s[t]||(s[t]=e.style[t])}},h.handleHtml=function(r,s,t){if(t){r._sm[s]=[],e(t)&&(t=[t]);for(var a=0;a<t.length;a++){var n,l=t[a],i={};if(0===l.indexOf("!")&&(l=l.substring(1),i.quiet=!0),l.indexOf("<")>-1){for(var u=r;0===l.indexOf("+");)l=l.substring(1),u=u.parentNode;var f=o.createElement("div");f.innerHTML=l,n=f.children[0],u.parentNode.insertBefore(n,u.nextElementSibling)}else n=o.querySelector(l);n&&(i.dom=n,n.style.display="none",r._sm[s].push(i))}}},h.handleCss=function(r,s,t){if(t){e(t)&&(t=[t]),r._sm[s]=[];for(var a=t.length-1;a>=0;a--){for(var n=t[a],l=r;0===n.indexOf("+");)n=n.substring(1),l=l.parentNode;r._sm[s].push({target:l,className:n})}}},h.parseRule=function(e,r){var s=e.name,t=this.rules[s]||y.rules[s];t&&(t instanceof Array?r.rules.push({rule:t[0],message:t[1]}):r.rules.push({rule:t,params:e.params}))},h.parseStringFunction=function(e){var r={name:e},s=e.indexOf("(");return s>0&&(r.name=e.substring(0,s),r.params=e.substring(s+1,e.length-1).split(",")),r},h.parseString=function(e){var r={rules:[]},s=e.indexOf("&")>-1?"&":"|",t=e.split(s);r.token=s;for(var a=t.length-1;a>=0;a--){var n=t[a];if(n)if(0===n.indexOf("/")){var l=n.substring(1).split("/");2===l.length?r.rules.push({rule:new RegExp(l[0]),message:l[1]}):3===l.length&&r.rules.push({rule:new RegExp(l[0],"i"),message:l[2]})}else{var i=this.parseStringFunction(n),u=i.name,o=!0;if("!"===u.charAt(0)&&(u=u.substring(1),o=!1),m.indexOf(u)>-1){var f=i.params;f?r[u]="failStyle"===u||"passStyle"===u?f[0]:f:r[u]=o}else this.parseRule(i,r)}}return r},h.parseField=function(r){if(r instanceof Array)return{rules:[{rule:r[0],message:r[1]}]};if(r instanceof Function)return{rules:[{rule:r}]};if(e(r))return this.parseString(r);if("object"==typeof r){if(r.token="|",r.rule instanceof Array)r.rules=[{rule:r.rule[0],message:r.rule[1]}];else if(r.rule instanceof Function)r.rules=[{rule:r.rule}];else if(e(r.rule)){var s=r.rule;delete r.rule,s.indexOf("&")>-1&&(r.token="&");var t=s.split(r.token);r.rules=[];for(var a=t.length-1;a>=0;a--)t[a]&&this.parseRule(this.parseStringFunction(t[a]),r)}return r}};var d,v,y={server:"not been validated by server",required:"this is required",rules:{}};s.config=function(e){for(var t=m.length-1;t>=0;t--){var a=m[t];r(e,a)&&(y[a]=e[a])}if(e.rules)for(var n in e.rules)y.rules[n]=e.rules[n];d=new s},s.validate=function(r,s){var t=e(r)?d.queryInput(r):r,a=0,n=0,l=!1;s&&(v=s.locate,l=s.short);for(var u=t.length-1;u>=0;u--){var o=t[u];if(o._sm)if(n++,i(o,s)===!0)a++;else if(l)return!1}return n===a},s.reset=function(r){for(var s=e(r)?d.queryInput(r):r,t=s.length-1;t>=0;t--)l(s[t])};var b={number:"only number",email:"wrong email format",range_equal:"value must be equal to {0}",range_scope:"value must be greater than {0} and less than {1}",range_greater:"value must be greater than {0}",range_less:"value must be less than {0}",renge_no_number:"value must be number",error_param:"error param",length_equal:"length must be equal to {0}",length_scope:"length must be greater than {0} and less than {1}",length_greater:"length must be greater than {0}",length_less:"length must be less than {0}",password:"passwords don't match"};s.config({failHtml:'<span style="color:#c00;"></span>',failStyle:{color:"#c00",border:"1px solid #c00"},rules:{number:[/^-?\d+(\.{1}\d+)?$/,b.number],email:[/^[\w\+\-]+(\.[\w\+\-]+)*@[a-z\d\-]+(\.[a-z\d\-]+)*\.([a-z]{2,4})$/i,b.email],range:function(e,r,s){e=1*e;var t=/^-?\d+(\.{1}\d+)?$/;return t.test(e)?r&&!t.test(r)&&s&&!t.test(s)?b.error_param:2===arguments.length?e==r||u(b.range_equal,[r]):3===arguments.length?r&&s?e>r&&e<s||u(b.range_scope,[r,s]):r?e>r||u(b.range_greater,[r]):s?e<s||u(b.range_less,[s]):b.error_param:void 0:b.renge_no_number},length:function(e,r,s){var t=e.length;return 2===arguments.length?t==r||u(b.length_equal,[r]):3===arguments.length?r&&s?t>r&&t<s||u(b.length_scope,[r,s]):r?t>r||u(b.length_greater,[r]):s?t<s||u(b.length_less,[s]):b.error_param:void 0},equal:function(e,r){var s=o.querySelector(r);return e===s.value||b.password}}}),s.setLang=function(e){for(var r in e)b[r]=e[r]};var _={bootstrap:{failStyle:{},failHtml:['!<span class="glyphicon glyphicon-remove form-control-feedback"></span>','<small class="help-block"></small>'],failCss:"++has-error has-feedback",passHtml:'<span class="glyphicon glyphicon-ok form-control-feedback"></span>',passCss:"++has-success has-feedback"},semantic:{failStyle:{},failHtml:['!<i class="remove icon"></i>','+<small class="ui red pointing label"></small>'],failCss:"++error",passHtml:'<i class="checkmark icon"></i>'}};return s.setSkin=function(e){s.config(_[e])},s});